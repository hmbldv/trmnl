# =============================================================================
# trmnl :: ZSH Configuration
# Cross-platform zsh config with Starship prompt
# =============================================================================

# -----------------------------------------------------------------------------
# History
# -----------------------------------------------------------------------------
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt HIST_IGNORE_DUPS      # Don't record duplicates
setopt HIST_IGNORE_SPACE     # Don't record commands starting with space
setopt SHARE_HISTORY         # Share history between sessions
setopt HIST_REDUCE_BLANKS    # Remove unnecessary blanks
setopt HIST_VERIFY           # Show command before executing from history

# -----------------------------------------------------------------------------
# Options
# -----------------------------------------------------------------------------
setopt AUTO_CD               # cd by typing directory name
setopt CORRECT               # Spell correction for commands
setopt COMPLETE_IN_WORD      # Complete from both ends of cursor
setopt INTERACTIVE_COMMENTS  # Allow comments in interactive shell

# -----------------------------------------------------------------------------
# fastfetch — system info on new shell
# -----------------------------------------------------------------------------
if command -v fastfetch &>/dev/null; then
    fastfetch
fi

# -----------------------------------------------------------------------------
# Key Bindings (emacs style)
# -----------------------------------------------------------------------------
bindkey -e
bindkey '^[[A' history-search-backward  # Up arrow
bindkey '^[[B' history-search-forward   # Down arrow

# -----------------------------------------------------------------------------
# Completion
# -----------------------------------------------------------------------------
autoload -Uz compinit && compinit
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'  # Case insensitive
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"    # Colored completions

# -----------------------------------------------------------------------------
# Aliases (shared)
# -----------------------------------------------------------------------------
source "${0:A:h}/aliases.zsh" 2>/dev/null || true

# -----------------------------------------------------------------------------
# Platform Detection & Plugins
# -----------------------------------------------------------------------------
case "$(uname -s)" in
    Darwin)
        # macOS - Homebrew plugin paths
        if [[ -f /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]]; then
            source /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
        fi
        if [[ -f /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]]; then
            source /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh
        fi

        # Homebrew paths
        export PATH="/opt/homebrew/opt/libpq/bin:$PATH"
        ;;
    Linux)
        # Linux - System plugin paths
        if [[ -f /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]]; then
            source /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
        elif [[ -f ~/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]]; then
            source ~/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
        fi
        if [[ -f /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]]; then
            source /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh
        elif [[ -f ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh ]]; then
            source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh
        fi

        # Local bin
        export PATH="$HOME/.local/bin:$PATH"
        ;;
esac

# -----------------------------------------------------------------------------
# Git Worktree Helpers
# -----------------------------------------------------------------------------
source "${0:A:h}/git-worktree.zsh" 2>/dev/null || true

# -----------------------------------------------------------------------------
# fzf — fuzzy finder
# -----------------------------------------------------------------------------
if command -v fzf &>/dev/null; then
    eval "$(fzf --zsh)"
    export FZF_DEFAULT_OPTS=" \
--color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 \
--color=fg:#cdd6f4,header:#f38ba8,info:#cba6f7,pointer:#f5e0dc \
--color=marker:#b4befe,fg+:#cdd6f4,prompt:#cba6f7,hl+:#f38ba8 \
--color=selected-bg:#45475a \
--multi"
fi

# -----------------------------------------------------------------------------
# zoxide — smart cd
# -----------------------------------------------------------------------------
if command -v zoxide &>/dev/null; then
    eval "$(zoxide init zsh)"
fi

# -----------------------------------------------------------------------------
# Starship Prompt (must be at the end)
# -----------------------------------------------------------------------------
if command -v starship &>/dev/null; then
    eval "$(starship init zsh)"
fi
